<div th:fragment="deleteUserModal" id="deleteModal" class="v-modal" style="display:none;" aria-hidden="true">
    <div class="v-modal__content">
        <h3 class="v-h3">Confirm Deletion</h3>
        <p>Are you sure you want to delete <strong id="modalUserName">this user</strong>?</p>
        <p class="v-muted">This action cannot be undone.</p>

        <div class="v-modal__actions">
            <button type="button" onclick="closeModal()" class="v-btn v-btn--ghost">Cancel</button>

            <form id="deleteForm" method="post">
                <button type="submit" class="v-btn v-btn--danger">Confirm Delete</button>
            </form>
        </div>
    </div>

<script th:inline="javascript">
    var csrfParamName = /*[[${_csrf.parameterName}]]*/ "";
    var csrfToken = /*[[${_csrf.token}]]*/ "";

    function openDeleteModal(id, name) {
        const nameElement = document.getElementById('modalUserName');
        if (nameElement) nameElement.textContent = name;

        const form = document.getElementById('deleteForm');
        if (form) {
            form.action = '/admin/users/' + id + '/delete';
            // Clean up and re-add CSRF
            form.querySelectorAll('input[type="hidden"]').forEach(input => input.remove());
            const csrfInput = document.createElement('input');
            csrfInput.type = "hidden";
            csrfInput.name = csrfParamName;
            csrfInput.value = csrfToken;
            form.appendChild(csrfInput);
        }

        const modal = document.getElementById('deleteModal');
        if (modal) {
            modal.style.display = 'flex';
            modal.setAttribute('aria-hidden', 'false');
            // Focus the 'Cancel' button or 'Confirm' for accessibility
            const cancelBtn = modal.querySelector('.v-btn--ghost');
            if (cancelBtn) cancelBtn.focus();
        }
    }

    function closeModal() {
        const modal = document.getElementById('deleteModal');
        if (modal) {
            modal.style.display = 'none';
            modal.setAttribute('aria-hidden', 'true');
        }
    }

    // Listen for clicking outside the modal content to close it
    window.onclick = function(event) {
        const modal = document.getElementById('deleteModal');
        if (event.target == modal) closeModal();
    }
</script>
</div>